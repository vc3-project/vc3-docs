digraph requests {
    compound = true;
    #concentrate = true;
    ratio = compress;
    size="20";
    #rankdir="LR";

    ranksep = 0.15;
    nodesep = 0.15;

    node [fontsize=10]
    edge [fontsize=10];

    infoservice [shape = none ][ label = "" ];

    subgraph cluster_configstates {
        style = invis;
        new;
        validated;
        pending;
    }

    subgraph cluster_runningstates {
        style = invis;
        growing;
        shrinking;
        running;
    }

    subgraph cluster_endingstates {
        style = invis;
        terminating;
        terminated;

        terminating_all [shape = none][ label = ""]
    }

    {rank=same shrinking terminating terminated}

    infoservice -> new [ style = dotted ][ label = "pull\lnew\lrequest\l" ];

    new -> validated   [ label = "well\lformed" ];

    validated -> pending  [ label = "factory\ladds\lstatusinfo\lfield\l(factory just configured itself)" ][ style = dotted ];

    pending    -> growing     [ label = "statusinfo.running > 0" ][ style = dotted ];

    growing    -> running     [ label = "all needed in\lstatusinfo.running\l" ][ style = dotted ];

    growing    -> shrinking   [ label = "action = 'terminate'" ][ style = dotted ];

    running    -> growing     [ label = "less of needed in\lstatusinfo.running\l" ][ style = dotted ];
    running    -> shrinking   [ label = "action = 'terminate'" ][ style = dotted ];

    shrinking  -> terminating [ label = "request.statusinfo.running = 0"][ style = dotted ];

    terminating -> terminated [ label = "wait\lfor\lcleanup\l" ];

    terminating_all -> terminating [ label ="any\lerror\lfrom\lany\lstate\l" ]

}
