digraph requests {
    compound = true;
    #concentrate = true;
    ratio = compress;
    size="20";
    #rankdir="LR";

    ranksep = 0.15;
    nodesep = 0.15;

    node [fontsize=10]
    edge [fontsize=10];

    infoservice [shape = none ][ label = "" ];

    subgraph cluster_configstates {
        style = invis;
        new;
        validated;
        pending;
    }

    subgraph cluster_runningstates {
        style = invis;
        running;
    }

    subgraph cluster_endingstates {
        style = invis;
        terminating [ label = "terminating\nset jobs requested = 0"];
        cleanup;
        terminated;

        terminating_all [shape = none][ label = ""]
    }

    {rank=same cleanup terminating terminated}

    infoservice -> new [ style = dotted ][ label = "pull\lnew\lrequest\l" ];

    new -> validated   [ label = "well\lformed" ];

    validated -> pending  [ label = "factory\ladds\lstatusinfo\lfield\l(factory just configured itself)" ][ style = dotted ];

    pending    -> running     [ label = "statusinfo.running > 0" ][ style = dotted ];

    running    -> terminating [ label = "action = 'terminate'" ][ style = dotted ];


    terminating -> cleanup     [ label = "statusinfo.running == 0" ];

    cleanup     -> terminated  [ label = "garbage collected" ];


    terminating_all -> terminating [ label ="any\lerror\lfrom\lany\lstate\l" ];
}
